# 柱状图中最大的矩形

求在柱状图中，能够勾勒出来的矩形的最大面积。

## 解答

### 暴力

对每个离散柱，以其高度为矩形的高度，向左右扩散至无法扩散为止，更新答案。最坏时间复杂度$O(n^2)$。

其实用到了一点很简单的贪心，策略明显正确。

### 单调栈

#### 扩散过程

对序列中的每个$a_i$，我们需要找到最大的$j < i$，最小的$k > i$，满足$a_j < a_i$且$a_k < a_i$。注意，我们额外定义$a_0 = a_{n+1} = -\infin$。那么，矩形的宽度就是$k - j - 1$。如何将扩散过程的时间复杂度降低至$O(1)$？

### 解法

维护一个单调递增栈，线性扫描原序列，操作规则如下：

1. 如果扫描到的新元素比栈顶元素大（或者栈为空），则入栈；
2. 否则，弹栈直到新元素比栈顶元素大（或者栈为空），入栈。

容易证明，对该单调（递增）栈，其满足如下性质：

1. 栈内的元素始终递增。
2. 当有元素出栈时，待入栈元素是出栈元素在原序列中向后找，第一个比其小的元素。这就是$a_k$。
3. 当有元素出栈后，新的栈顶元素是出栈元素在原序列中向前找，第一个比其小的元素。这就是$a_j$。

因此，使用单调栈，扩散过程的时间复杂度可以降低为$O(1)$，因此整体时间复杂度降低为$O(n)$。
