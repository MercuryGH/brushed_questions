# 复制粘贴的最少次数：原始题目

设初始时文本中有 1 个字符，每次你可进行如下操作中的一项：

- CA：将当前所有文本载入剪贴板
- CV：将剪贴板的文本附加到当前文本后

若要让文本的字符数变为 $n$，请设计算法，输出最少操作次数。

## DP 解

### 朴素

记 $f_i$ 为让文本的字符数变为 $i$ 所需的最少操作次数，则答案在 $f_n$。

观察到，要让状态转移到 $i$，则转移的起始点必须为以下之一：

- $i/2$，只需一次 CA，一次 CV 即可转移到 $i$
- $i/3$，需要 CA、CV、CV 转移到 $i$
- ……
- $i/j$，需要 1 次 CA，$j-1$ 次 CV 转移到 $i$
- $i/i$，需要 $i$ 次操作转移到 $i$

且这些起始点必须是正整数状态。因此，状态转移方程为

$$
f_i = \min_{j \in [2, i], i \bmod j = 0}(f_{i / j} + j).
$$

初始条件为 $f_1=0$。时间复杂度 $O(n^2)$。

### 小优化

观察到只需枚举 $j \in [2, \sqrt i]$，即可分别枚举

- $i/j, i \bmod j = 0$
- $j, i \bmod j = 0$

两个转移前的状态，此时时间复杂度可优化为 $O(n \sqrt n)$。

### 数学优化

考虑将 $n$ 进行素因数分解

$$
n = \prod_{i=1}^j \alpha_i
$$

其中 $\alpha_i$ 均为素数，那么，我们从状态 $1$ 转移到状态 $n$ 的一个最短路径可以描述如下：

- 将 $\alpha_i$ 由小到大排序。
- 从 $1$ 转移到 $\alpha_1$，这需要 $\alpha_1$ 次操作
- 从 $\alpha_1$ 转移到 $\alpha_1\alpha_2$，这需要 $\alpha_2$ 次操作
- ……
- 从 $\prod_{i=1}^{j-1} \alpha_i$ 转移到 $n$，这需要 $\alpha_j$ 次操作

因此，总共需要 $\sum_{i=1}^j \alpha_i$ 次操作。可以证明，这就是最少的操作次数。

因此我们只需对 $n$ 做素因数分解并输出它们的和即可。时间复杂度为 $O(\sqrt n)$。

## 网易笔试加强版

设初始时文本中有 1 个字符，每次你可进行如下操作中的一项：

- CA：全选当前文本
- CS：选中 1 个字符
- CC：将选中的文本载入剪贴板
- CV：将剪贴板的文本附加到当前文本后

若要让文本的字符数变为 $n$，请设计算法，输出最少操作次数。

例如，$n=3$ 时，最少操作次数为 4（CA, CC, CV, CV），$n=8$ 时，最少操作次数为 8 （CA, CC, CV, CA, CC, CV, CV, CV）

### DP 解

要让状态转移到 $i$，考虑以下转移路径

- $i-1$ 到 $i$，需要 CS、CC、CV，3 次操作
- $i/2$ 到 $i$，需要 CA，CC，CV，3 次操作
- $i/3$ 到 $i$，需要 4 次操作
- ……
- $i/j$ 到 $i$，需要 $j+1$ 次操作

故

$$
f_i = \min(f_{i-1} + 3, \min_{j \in [2, i], i \bmod j = 0}(f_{i / j} + j + 1)).
$$

初始条件为 $f_1=0$。时间复杂度 $O(n^2)$。

小优化仍然适用，可优化到 $O(n \sqrt n)$。
