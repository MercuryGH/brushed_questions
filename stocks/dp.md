# 买卖股票的最佳时机 II

给定股票价格序列 $a_n$。在每一天，你可能会决定购买和/或出售股票。你在任何时候 **最多** 只能持有 **一股** 股票。给出你能获得的 **最大** 利润。

## DP解

记$f_{i,j}$表示当只考虑子序列$a_{1:i}$，在持有股票$(j=1)$或不持有股票$(j=0)$的情况下，所能获得的最大利润。那么，考虑$a_i$是否买入/卖出的情况，可以进行一步状态转移：

$$
f_{i,0} = \max(f_{i-1, 0}, f_{i-1,1} + a_i),\\
f_{i,1} = \max(f_{i-1, 0} - a_i, f_{i-1, 1}).
$$

初始条件为$f_{1,0} = 0, f_{1,1} = -a_i$。

## 贪心解

贪心思想：购买昨天的股票，并在今天卖出，当且仅当今天的股价比昨天高。不考虑隔天的买卖。

贪心解的公式：$\sum_{i=2}^n \max(a_i - a_{i-1}, 0)$。

贪心解正确性的证明：见官方题解，证明很详细（不是与最优解比较证明相容，而是将优化问题转化）。

# 买卖股票的最佳时机 III

给定股票价格序列 $a_n$。在每一天，你可能会决定购买和/或出售股票。你在任何时候 **最多** 只能持有 **一股** 股票。你最多可以完成 **两笔** 交易。给出你能获得的 **最大** 利润。

## DP解

由于我们最多可以完成两笔交易，因此在任意一天结束之后，我们会处于以下五个状态中的一种：

* 未进行过任何操作；
* 只进行过一次买操作；
* 进行了一次买操作和一次卖操作，即完成了一笔交易；
* 在完成了一笔交易的前提下，进行了第二次买操作；
* 完成了全部两笔交易。

由于第一个状态的利润显然为 $0$，因此我们可以不用将其记录。对于剩下的四个状态，我们分别将它们的最大利润记为$\alpha_i, \beta_i, \gamma_i, \zeta_i$……

更一般地，记$f_{i,j,k}$表示当只考虑子序列$a_{1:i}$，在持有股票$(j=1)$或不持有股票$(j=0)$，且已经完成了$k$次卖出的情况下，所能获得的最大利润。

$$
\begin{aligned}
f_{i,0,0} &= 0, \\
f_{i,1,0} &= \max(f_{i-1,0,0}-a_i, f_{i-1,1,0}), \\
f_{i,0,1} &= \max(f_{i-1,1,0}+a_i, f_{i-1,0,1}), \\
f_{i,1,1} &= \max(f_{i-1,0,1}-a_i, f_{i-1,1,1}), \\
f_{i,0,2} &= \max(f_{i-1,1,1}+a_i, f_{i-1,0,2}), \\
f_{i,1,2} &= -\infty, \\
\end{aligned}
$$

其中，$f_{i,1,2}$声明为$-\infty$是为了不让策略走入“买入第$3$次”，不符合题目要求。

初值条件略，自行推导。

最终答案为$\max_{k\in\{0,1,2\}}(f_{i,0,k})$。

# 买卖股票的最佳时机 IV

给定股票价格序列 $a_n$。在每一天，你可能会决定购买和/或出售股票。你在任何时候 **最多** 只能持有 **一股** 股票。你最多可以完成 $t$ 笔交易。给出你能获得的 **最大** 利润。

## DP解

第$i$天不持有股票时：

1. 如果第$i-1$天也不持有股票，则状态不变，$f_{i,0,k}=f_{i-1,0,k}$。
2. 如果第$i-1$天持有股票，说明我们在第$i$天卖出股票。卖出股票的同时，当天的卖出次数要在前一天的基础上$+1$。有$f_{i,0,k}=f_{i-1,1,k-1}+a_i$。

第$i$天持有股票时：

1. 如果第$i-1$天也持有股票，那就代表状态不变，即$f_{i,1,k}=f_{i-1,1,k}$。
2. 如果第$i-1$天不持有股票，说明我们在第$i$天买入股票，既然买股票要花钱，利润就要少$a_i$。故$f_{i,1,k}=f_{i-1,0,k} + a_i$。

综上所述，推广Ⅲ得到的状态转移方程为（$\forall k \geq 1$）：

$$
\begin{aligned}
f_{i,0,k} &= \max(f_{i-1,0,k}, f_{i-1,1,k} + a_i), \\
f_{i,1,k} &= \max(f_{i-1,1,k}, f_{i-1,0,k-1} - a_i).
\end{aligned}
$$

并且，限制$t$笔交易的特殊条件为

$$
f_{i,1,t} = -\infty.
$$

# 最佳买卖股票时机含冷冻期

给定股票价格序列 $a_n$。在每一天，你可能会决定购买和/或出售股票。你在任何时候 **最多** 只能持有 **一股** 股票。你最多可以完成 **两笔** 交易。每次卖出后，下一天都无法进行买入操作。给出你能获得的 **最大** 利润。

## DP解

这道题的第二维只是比 Ⅱ 多了一个状态。记$f_{i,j}$表示当只考虑子序列$a_{1:i}$，在

* 持有股票$(j=0)$，
* 不持有股票且今天可买入$(j=1)$，或
* 不持有股票且今天不可买入$(j=2)$

的情况下，所能获得的最大利润。DP方程留作练习。

# 买卖股票的最佳时机含手续费

这道题的状态转移方程只是比 Ⅱ 多了一个“手续费”。

DP方程留作练习。

其实也有贪心解，就是比较复杂。
