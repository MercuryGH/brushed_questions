# 能转向的贪吃蛇

给定一个$n \times n$棋盘，其中有若干障碍点。

初始时，蛇的尾部位于$(0,0)$，头部位于$(0, 1)$，呈水平状态。蛇每一步可以选择如下操作中的任意一种：

1. （无论水平或竖直状态均能进行）整体向右或向下平移一格；
2. 改变朝向：
   * 若蛇处于水平状态，则尾部位置$(x,y)$不变，头部位置从$(x, y+1)$变成$(x+1,y)$；
   * 若蛇处于竖直状态，则尾部位置$(x,y)$不变，头部位置从$(x+1,y)$变成$(x,y+1)$；

以上操作能够执行的必要条件是，执行后，蛇不能与任一障碍点重合或越过棋盘边界。

现在，请给出蛇从初始状态，转移到“尾部位于$(n-1,n-2)$，头部位于$(n-1,n-1)$”的终结状态，所需操作步数的最小值。若因障碍过多而不可能转移到终结状态，也请输出-1。

## DP解

记$f_{i,j,k}$为蛇的尾部位于$(i,j)$，当前状态为水平（$k=0$）或竖直（$k=1$）时，从$f_{0,0,0}$转移到该状态所需的操作步数的最小值。那么答案在$f_{n-1,n-2, 0}$。

考虑状态转移（以下转移均在不与任一障碍点重合或越过棋盘边界时进行）：

* 向下平移一格：$f_{i,j,k} = f_{i-1,j,k} + 1$。
* 向右平移一格：$f_{i,j,k} = f_{i,j-1,k} + 1$。
* 改变朝向：$f_{i,j,k} = f_{i,j,\bar k} + 1$。

$f_{i,j,k}$的值即为以上三者取$\min$。但注意到“改变朝向”那里的计算涉及到循环依赖，怎么办呢？

我们注意到，在同一个位置改变朝向两次或两次以上是没有必要的。因此，如果我们需要改变朝向，不妨只考虑“从上一个状态平移过来，然后改变朝向”这个两部转移。即

$$
f_{i,j,k} = \min(f_{i-1,j,\bar k}, f_{i,j-1,\bar k}) + 2.
$$

故状态转移方程为

$$
f_{i,j,k} = \min(\min(f_{i-1,j,k}, f_{i,j-1,k}) + 1, \min(f_{i-1,j,\bar k}, f_{i,j-1,\bar k}) + 2).
$$

初始条件为$f_{0,0,0} = 0$。（$f_{0,0,1}$的值与障碍有关）。

## DP写崩了

因为“在不与任一障碍点重合或越过棋盘边界时进行”DP，写法细节很多，太难写对了。

本题考虑倒推DP会好写一点也就是$f_{i,j,k}$表示为蛇的尾部位于$(i,j)$，当前状态为水平（$k=0$）或竖直（$k=1$）时，到达终结状态$f_{n-1,n-2,0}$所需的操作步数的最小值。
